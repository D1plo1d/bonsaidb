<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Derives a set of traits that can be used to implement a permissions-driven API. There are options that can be customized with the `#[actionable]` attribute at the enum level:"><meta name="keywords" content="rust, rustlang, rust-lang, Actionable"><title>Actionable in bonsaidb_core::permissions - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc derive"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../bonsaidb_core/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../bonsaidb_core/index.html"><div class="logo-container"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><div class="sidebar-elems"><h2><a href="index.html">In bonsaidb_core::permissions</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Derive Macro <a href="../index.html">bonsaidb_core</a>::<wbr><a href="index.html">permissions</a>::<wbr><a class="derive" href="#">Actionable</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><div class="item-decl"><pre class="rust derive"><code>#[derive(Actionable)]
{
    // Attributes available to this derive:
    #[actionable]
}
</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Derives a set of traits that can be used to implement a permissions-driven
API. There are options that can be customized with the <code>#[actionable]</code>
attribute at the enum level:</p>
<ul>
<li>Crate name override: <code>#[actionable(actionable = &quot;someothername&quot;)]</code>. If you
find yourself needing to import <code>actionable</code> as another name, this setting
will replace all mentions of <code>actionable</code> with the identifier specified.</li>
</ul>
<h3 id="the-dispatcher-trait"><a href="#the-dispatcher-trait">The Dispatcher Trait</a></h3>
<p>The first trait that is generated is named <code>&lt;EnumName&gt;Dispatcher</code>. For
example, if the enum’s name is <code>Request</code>, the generated trait name will be
<code>RequestDispatcher</code>. This trait has no methods for you to implement. It
defines several associated types:</p>
<ul>
<li><code>Output</code>: The <code>Ok</code> side of the <code>Result</code>.</li>
<li><code>Error</code>: The <code>Err</code> side of the <code>Result</code>. Must implement
<code>From&lt;actionable::PermissionDenied&gt;</code>.</li>
<li>For each variant in the enum, another Trait named <code>&lt;VariantName&gt;Handler</code>.
For example, if the enum variant was <code>Request::AddUser</code>, the trait will be
<code>AddUserHandler</code>. Each of these traits must be implemented by any type
implementing <code>&lt;EnumName&gt;Dispatcher</code>.</li>
</ul>
<p>The dispatcher trait has a method available for you to use to dispatch
requests: <code>async fn dispatch(&amp;self, permissions: &amp;Permissions, request: &lt;EnumName&gt;) -&gt; Result&lt;Self::Output, Self::Error&gt;</code>.</p>
<h3 id="the-handler-traits"><a href="#the-handler-traits">The Handler Traits</a></h3>
<p>For each variant in the enum, a trait will be generated named
<code>&lt;VariantName&gt;Handler</code>. Using the same example above, the enum variant
<code>Request::AddUser</code> would generate the trait <code>AddUserHandler</code>. These traits
are implemented using the
<a href="https://crates.io/crate/async-trait"><code>async-trait</code></a> trait.</p>
<p>Each variant must have a protection method assigned using the
<code>#[actionable]</code> attribute. There are three protection methods:</p>
<h4 id="no-protection-actionableprotection--none"><a href="#no-protection-actionableprotection--none">No Protection: <code>#[actionable(protection = &quot;none&quot;)]</code></a></h4>
<p>A handler with no protection has one method:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[async_trait]
</span><span class="kw">trait </span>Handler {
    <span class="kw">type </span>Dispatcher;
    <span class="kw">async fn </span>handle(
        dispatcher: <span class="kw-2">&amp;</span><span class="self">Self</span>::Dispatcher,
        permissions: <span class="kw-2">&amp;</span>Permissions,
        <span class="comment">/* each field on this variant is passed
        as a parameter to this method */
    </span>) -&gt; <span class="prelude-ty">Result</span>&lt;Output, Error&gt;;
}</code></pre></div>
<p>Actionable does not do any checks before invoking this handler.</p>
<h4 id="simple-protection-actionableprotection--simple"><a href="#simple-protection-actionableprotection--simple">Simple Protection: <code>#[actionable(protection = &quot;simple&quot;)]</code></a></h4>
<p>A handler with simple protection exposes methods and types to allow
specifying an <code>actionable::ResourceName</code> and an <code>Action</code> for this handler:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[async_trait]
</span><span class="kw">trait </span>Handler {
    <span class="kw">type </span>Dispatcher;
    <span class="kw">type </span>Action;

    <span class="kw">fn </span>resource_name&lt;<span class="lifetime">&#39;a</span>&gt;(
        dispatcher: <span class="kw-2">&amp;</span><span class="self">Self</span>::Dispatcher,
        <span class="comment">/* each field on this variant is passed
        by reference as a parameter to this method */
    </span>) -&gt; ResourceName&lt;<span class="lifetime">&#39;a</span>&gt;;

    <span class="kw">fn </span>action() -&gt; <span class="self">Self</span>::Action;

    <span class="kw">async fn </span>handle_protected(
        dispatcher: <span class="kw-2">&amp;</span><span class="self">Self</span>::Dispatcher,
        permissions: <span class="kw-2">&amp;</span>Permissions,
        <span class="comment">/* each field on this variant is passed
        as a parameter to this method */
    </span>) -&gt; <span class="prelude-ty">Result</span>&lt;Output, Error&gt;;
}</code></pre></div>
<p>When the handler is invoked, it first checks <code>permissions</code> to ensure that
<code>action()</code> is allowed to be performed on <code>resource_name()</code>. If it is not
allowed, an <code>actionable::PermissionDenied</code> error will be returned. If it is
allowed, <code>handle_protected()</code> will be executed.</p>
<h4 id="custom-protection-actionableprotection--custom"><a href="#custom-protection-actionableprotection--custom">Custom Protection: <code>#[actionable(protection = &quot;custom&quot;)]</code></a></h4>
<p>A handler with custom protection has two methods, one to verify permissions
and one to execute the protected code:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[async_trait]
</span><span class="kw">trait </span>Handler {
    <span class="kw">type </span>Dispatcher;
    <span class="kw">async fn </span>verify_permissions(
        dispatcher: <span class="kw-2">&amp;</span><span class="self">Self</span>::Dispatcher,
        permissions: <span class="kw-2">&amp;</span>Permissions,
        <span class="comment">/* each field on this variant is passed
        by refrence as a parameter to this method */
    </span>) -&gt; <span class="prelude-ty">Result</span>&lt;(), Error&gt;;

    <span class="kw">async fn </span>handle_protected(
        dispatcher: <span class="kw-2">&amp;</span><span class="self">Self</span>::Dispatcher,
        permissions: <span class="kw-2">&amp;</span>Permissions,
        <span class="comment">/* each field on this variant is passed as a parameter
        to this method */
    </span>) -&gt; <span class="prelude-ty">Result</span>&lt;Output, Error&gt;;
}</code></pre></div>
<p>Actionable will first call <code>verify_permissions()</code>. If you return <code>Ok(())</code>,
your <code>handle_protected()</code> method is invoked.</p>
<h3 id="why-should-you-use-the-built-in-protection-modes"><a href="#why-should-you-use-the-built-in-protection-modes">Why should you use the built-in protection modes?</a></h3>
<p>Actionable attempts to make permission handling easy to understand and
implement while making it difficult to forget implementing permission
handling. This is only effective if you use the protection levels.</p>
<p>Because Actionable includes <code>permissions</code> in every call to
<code>handle[_protected]()</code>, technically you could use a protection level of
<code>none</code> and implement permission handling within the <code>handle()</code> function.
While it would work, you shouldn’t do this.</p>
<p>Actionable encourages placing information about permission handling in the
definition of the enum. By using <code>simple</code> and <code>custom</code> protection
strategies, consumers of your API will be able to see at the enum level what
APIs check permissions. When trying to understand what permissions are being
used, this is critical.</p>
<p>By placing your permission handling code in locations that follow a
repeatable patern, you’re helping anyone who is reading the code separate
what logic is related to permission handling and what logic is related to
the API implementation.</p>
<h3 id="what-protection-mode-should-you-use"><a href="#what-protection-mode-should-you-use">What protection mode should you use?</a></h3>
<ul>
<li>If your handler is operating on a single resource and performing a single
action, use the <code>simple</code> protection mode.</li>
<li>If your handler needs to check permissions but it’s more complicated than
the first scenario, use the <code>custom</code> protection mode.</li>
<li>If you aren’t enforcing permissions inside of this handler, use the <code>none</code>
protection mode.</li>
</ul>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="bonsaidb_core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.0 (fc594f156 2023-01-24)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>