<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Encryption and secret management."><meta name="keywords" content="rust, rustlang, rust-lang, vault"><title>bonsaidb::local::vault - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../../normalize.css"><link rel="stylesheet" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../../ayu.css" disabled><link rel="stylesheet" href="../../../dark.css" disabled><link rel="stylesheet" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../bonsaidb/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../bonsaidb/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module vault</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Module <a href="../../index.html">bonsaidb</a>::<wbr><a href="../index.html">local</a>::<wbr><a class="mod" href="#">vault</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/bonsaidb_local/lib.rs.html#29">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Encryption and secret management.</p>
<p>BonsaiDb’s vault is the core of encryption and secret management. To offer
this security, BonsaiDb relies on external <a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a> to provide
the key needed to decrypt the master keys. After the master keys have been
decrypted, the vault is able to function without <a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a>. This
design ensures that if a copy of a database was stolen, the data that is
stored at-rest cannot be decrypted without gaining access to
<a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a>.</p>
<h3 id="at-rest-encryption"><a href="#at-rest-encryption">At-Rest Encryption</a></h3>
<p>At-rest encryption only ensures that if the database files are stolen that
an attacker cannot access the data without the encryption key. BonsaiDb
will regularly decrypt data to process it, and while the data is in-memory,
it is subject to the security of the machine running it. If using BonsaiDb
over a network, the network transport layer’s encryption is what ensures
your data’s safety.</p>
<h3 id="security-best-practices"><a href="#security-best-practices">Security Best Practices</a></h3><h4 id="vault-key-storage"><a href="#vault-key-storage">Vault Key Storage</a></h4>
<p>In most situations, do not use <a href="struct.LocalVaultKeyStorage.html" title="LocalVaultKeyStorage"><code>LocalVaultKeyStorage</code></a> in a production
environment. If you store the vault keys on the same disk as the database,
it’s similar to hiding a key to your house under your doormat. It might stop
the casual person from entering your house, but give any attacker a few
minutes, and they’ll find the key.</p>
<p>Instead, you should use a storage location that provides authentication and
encryption. Our recommendation for production enviroments is to find an
Amazon S3-compatible storage service and use
<a href="https://dev.bonsaidb.io/main/docs/bonsaidb_keystorage_s3/struct.S3VaultKeyStorage.html"><code>S3VaultKeyStorage</code></a>.
Eventually, other BonsaiDb servers will be able to operate as key storage
for each other.</p>
<h3 id="encryption-algorithms-used"><a href="#encryption-algorithms-used">Encryption Algorithms Used</a></h3>
<p>BonsaiDb uses the <a href="https://github.com/rozbb/rust-hpke"><code>hpke</code></a> crate to
provide Hybrid Public Key Encryption (HPKE) when public key encryption is
being used. This is currently only utilized for encrypting the master keys
with the vault key. Our HPKE uses <code>P256+HKDF-SHA256+ChaCha20Poly1305</code>.
Long term, we plan to offer public key encryption APIs on top of these same
choices.</p>
<p>For at-rest data encryption, the <a href="https://github.com/RustCrypto/AEADs"><code>AEAD</code>
<code>XChaCha20Poly1305</code></a> implementation is
used directly. This variant of <code>ChaCha20Poly1305</code> extends the nonce from 12
bytes to 24 bytes, which allows for random nonces to be used.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LocalVaultKeyStorage.html" title="bonsaidb::local::vault::LocalVaultKeyStorage struct">LocalVaultKeyStorage</a></div><div class="item-right docblock-short">Stores vault key locally on disk. This is in general considered insecure,
and shouldn’t be used without careful consideration.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="bonsaidb::local::vault::Error enum">Error</a></div><div class="item-right docblock-short">Errors relating to encryption and/or secret storage.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.KeyPair.html" title="bonsaidb::local::vault::KeyPair enum">KeyPair</a></div><div class="item-right docblock-short">A private encryption key.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.LocalVaultKeyStorageError.html" title="bonsaidb::local::vault::LocalVaultKeyStorageError enum">LocalVaultKeyStorageError</a></div><div class="item-right docblock-short">Errors from local vault key storage.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.PublicKey.html" title="bonsaidb::local::vault::PublicKey enum">PublicKey</a></div><div class="item-right docblock-short">A public key corresponding to a <a href="enum.KeyPair.html" title="KeyPair"><code>KeyPair</code></a>.</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.AnyVaultKeyStorage.html" title="bonsaidb::local::vault::AnyVaultKeyStorage trait">AnyVaultKeyStorage</a></div><div class="item-right docblock-short">A <a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a> trait that wraps the Error type before returning. This
type is used to allow the Vault to operate without any generic parameters.
This trait is auto-implemented for all <a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a> implementors.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.VaultKeyStorage.html" title="bonsaidb::local::vault::VaultKeyStorage trait">VaultKeyStorage</a></div><div class="item-right docblock-short">Stores encrypted keys for a vault.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="bonsaidb" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.1 (90743e729 2023-01-10)" ></div></body></html>